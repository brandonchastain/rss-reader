@page "/timeline"
@using WasmApp.Pages.Detail
@inherits PostPageBase
@rendermode InteractiveWebAssembly
@attribute [StreamRendering]
@attribute [Authorize]
@inject ILogger<Timeline> logger
@inject IJSRuntime jsRuntime

<PageTitle>Timeline</PageTitle>
<SectionContent SectionName="page-title">Timeline</SectionContent>

<CascadingValue Value="@Page" Name="Page">
<CascadingValue Value="@Items" Name="Posts">
    <PostTable OnPageChanged="UpdatePage" FeedClient="@this.feedClient" OnRefreshTriggered="RefreshItems" />
</CascadingValue>
</CascadingValue>

@code {

    protected override async Task<List<NewsFeedItem>> GetPostsAsync()
    {
        var posts = await this.feedClient.GetTimelineAsync(Page);
        return posts?.ToList() ?? new List<NewsFeedItem>();
    }

    protected override async Task OnAfterRenderAsync(bool firstRender)
    {
        await base.OnAfterRenderAsync(firstRender);

        if (firstRender && this.Items != null && this.Items.Any())
        {
            this.Items = await GetPostsAsync();
            this.StateHasChanged();
        }
    }
}